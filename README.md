# ThirdIntensive (Прогнозирование рыночных цен на арматуру)
Описание задания : Создание модели прогнозирования рыночных цен на арматуру для рекомендации лучшего времени для выгодной закупки арматуры.

Участники: Бухаров Егор, Ермаков Григорий, Пушмин Александр

## Анализ и обработка данных
*1. Загрузка данных*

Были загружены данные из файлов, содержащие информацию о рыночных ценах и различных макроэкономических показателях. Данные были объединены в один DataFrame, что позволило провести комплексный анализ.

*2. Визуализация динамики показателей*

Были построены линейные графики по каждому из загруженных файлов. Использовалась библиотека Seaborn, которая позволила создать эстетически привлекательные визуализации с использованием пастельной цветовой палитры.

- Первый этап визуализации: построены графики для каждого файла, где по оси X представлена дата, а по оси Y – последний столбец в данных.
- Второй этап визуализации: для каждого файла были построены графики по всем доступным показателям, что позволило оценить тренды и динамику.
- Был построен отдельный график для динамики цен на арматуру

*3. Объединение данных*

Все загруженные таблицы были объединены в один DataFrame, после чего были проведены дополнительные преобразования:
- Приведение данных к недельным значениям с использованием агрегирования по первой дате недели.
- Обнаружение и обработка пропущенных значений.
- Создание новых признаков, таких как скользящие средние и лаговые переменные.

*4. Анализ пропущенных данных*

- Был проведен анализ наличия пропущенных значений с использованием библиотеки.
- Пропущенные значения были обработаны методом линейной интерполяции и последующим заполнением ближайшими известными значениями.

*5. Корреляционный анализ*

- Для выявления взаимосвязей между переменными была построена корреляционная матрица с помощью `sns.heatmap()`.
- Были выявлены сильные корреляции между ценами на арматуру и другими макроэкономическими показателями.

*6. Основные результаты*

6.1 Выявленные закономерности
- Определены тенденции во временных рядах, включая восходящие и нисходящие тренды.
- Определены периоды сезонных колебаний.
- Для некоторых показателей наблюдаются резкие скачки, требующие дополнительного анализа.

6.2 Статистические наблюдения
- Определены средние значения, стандартные отклонения и диапазоны показателей.
- Корреляционные зависимости между некоторыми параметрами.

## Исследование на стационарность

*1. Тест Дики-Фуллера*
Для каждого временного ряда выполняется тест Дики-Фуллера на стационарность. Гипотеза теста:
- Нулевая гипотеза (H0): временной ряд нестационарен (имеет единичный корень).
- Альтернативная гипотеза (H1): временной ряд стационарен.
Если p-value теста < 0.05, нулевая гипотеза отвергается, и ряд считается стационарным.
Результаты тестирования:
- ADF Statistic: -3.1931
- p-value: 0.0204
- Критические значения:
    1%:3.4464
    5%: -2.8686
    10%: -2.5705

Заключение: Ряд 'Концентрат коксующегося угля_Россия марка ГЖ FCA руб./т, без НДС' стационарен.

*2. Преобразование данных для обеспечения стационарности*
Для того чтобы все ряды стали стационарными, выполняются логарифмирование и дифференцирование данных:
1. Логарифмирование (натуральный логарифм)
2. Вычисление разности между последовательными значениями (дифференцирование)
3. Интерполяция пропущенных значений

После этих преобразований проводится повторное тестирование на стационарность.

*3. Прогнозирование временного ряда*
3.1. VAR-модель
Для прогнозирования временного ряда применяется модель VAR (Vector AutoRegressive).
1. Деление данных на обучающую (80%) и тестовую выборки.
2. Подгонка модели с максимальным лагом maxlags=5.
3. Прогнозирование на 368 шагов вперёд.
4. Оценка точности модели:
   R2: -1.9358
   MAE: 1966.62
   MSE: 210807921.41
   RMSE: 14519.22
График прогноза показывает значительное отклонение предсказанных значений от реальных данных.

3.2. SARIMAX-модель
Также была обучена модель SARIMAX (Seasonal AutoRegressive Integrated Moving Average with eXogenous regressors) с параметрами (1,0,1). В качестве экзогенных переменных использованы все столбцы, кроме Price.
Результаты модели:
  R2: -4.6469
  MAE: 20005.83
  MSE: 739920971.38
  RMSE: 27201.49
График прогноза показывает низкую точность предсказаний.

3.3. Прогнозирование с использованием LSTM
Дополнительно была реализована нейросетевая модель LSTM (Long Short-Term Memory) для прогнозирования временного ряда. Основные этапы:
1. Нормализация данных (MinMaxScaler).
2. Формирование обучающих последовательностей с окном lookback=10.
3. Архитектура сети
4. Обучение модели на 50 эпохах с batch_size=32.
5. Прогнозирование на тестовой выборке.

Результаты модели LSTM:
  R2: 0.7321
  MAE: 987.45
  MSE: 9021345.23
  RMSE: 3003.56
График прогноза показывает значительно лучшее соответствие реальным данным по сравнению с VAR и SARIMAX.

4. Выводы
- Некоторые ряды в исходных данных стационарны, но большинство требуют преобразований (логарифмирование, дифференцирование).
- VAR-модель показывает плохую предсказательную способность (отрицательный R2).
- SARIMAX также даёт слабые результаты, что говорит о сложности прогнозирования данного временного ряда стандартными методами.
- Модель LSTM продемонстрировала лучшую точность прогнозирования.


## Моделированиe
*1. Введение*

В данном исследовании рассматривается анализ исторических цен на арматуру и дополнительные данные для построения модели рекомендаций по объему тендера. Основной целью является выявление закономерностей и корреляций, а также разработка алгоритма прогнозирования оптимального объема закупок.

*2. Описание данных*

Загруженный датасет содержит информацию о:
- Исторических ценах на арматуру
- Дополнительных рыночных показателях
- Характеристиках тендеров
Были проведены предварительные этапы обработки данных, включая их очистку, устранение пропусков и приведение к единому формату.

*3. Анализ данных*

*3.1. Первичный анализ*

Проведен первичный статистический анализ данных:
- Рассчитаны основные статистики (среднее, медиана, стандартное отклонение)
- Построены графики распределения цен
- Выявлены выбросы и аномалии

*3.2. Корреляционный анализ*

Выявлены корреляции между различными параметрами. Основные наблюдения:
- Значительная зависимость цен от рыночных факторов
- Связь между объемом закупок и тендерными характеристиками

*4. Построение модели*

*4.1. Выбор модели*

Были рассмотрены несколько подходов к прогнозированию:
- Линейная регрессия
- Градиентный бустинг
- Нейронные сети
  
На основе тестирования выбран оптимальный алгоритм, обеспечивающий наилучшее качество предсказания.

*4.2. Оценка модели*

Оценка качества модели проводилась с использованием метрик MAE, RMSE. Итоговая точность модели соответствует допустимым требованиям.

*5. Выводы*

В ходе исследования были выявлены значимые закономерности, что позволило разработать алгоритм для рекомендации объемов тендеров на арматуру.

##Сравнение моделей

| **Название модели** | **Тип модели**         | **Используемые данные** | **Основные параметры**                            | **Метрики качества**                              | **Плюсы**                        | **Минусы**                       |
|---------------------|-----------------------|------------------------|-------------------------------------------------|-------------------------------------------------|---------------------------------|--------------------------------|
| CatBoost_10K       | Градиентный бустинг    | Финансовые данные      | `iterations=10000, learning_rate=0.03, depth=6` | `MAE, R2, MSE`                                   | Высокая точность, стабильность | Долгое обучение                |
| CatBoost_1K        | Градиентный бустинг    | Финансовые данные      | `iterations=1000, learning_rate=0.1, depth=6`  | `MAE, R2, MSE`                                   | Быстрее обучается              | Меньше итераций — ниже точность |
| BaseLine       | Временные ряды        | Временные ряды        | `VARIMA(maxlags=5), SARIMAX(order=(1,0,1))`     | `R2, MAE, MSE, RMSE`                            | Подходит для временных рядов   | Чувствительна к сезонности      |
| XGBoost           | Градиентный бустинг    | Финансовые данные      | `objective='reg:squarederror'`                  | `MAE: 1242.21, MSE: 4798512.99, RMSE: 2190.55`  | Гибкость, высокая точность     | Чувствителен к параметрам       |
